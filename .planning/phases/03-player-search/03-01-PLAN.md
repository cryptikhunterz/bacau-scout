---
phase: 03-player-search
plan: 01
type: execute
---

<objective>
Implement instant player search with real-time results as user types.

Purpose: Core feature enabling scouts to quickly find players by name with <100ms response time.
Output: Working search bar on homepage that returns matching players instantly.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-layer/02-01-SUMMARY.md

**Key files:**
@src/lib/supabase.ts
@src/types/player.ts
@src/app/page.tsx

**Tech stack available:** Next.js 14, Supabase client, Tailwind CSS
**Established patterns:** Supabase client in src/lib/, types in src/types/

**From Phase 2:**
- 576 players in database
- Full-text search index on name: `idx_players_name` using `to_tsvector('simple', name)`
- Player type defined with all fields

**Constraining decisions:**
- [Phase 2]: TEXT id instead of UUID (matches TM player IDs)
- [Phase 2]: Public read access via RLS policy (no auth needed for search)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create search API endpoint</name>
  <files>src/app/api/players/search/route.ts</files>
  <action>
Create Next.js API route that:
1. Accepts GET request with `q` query parameter (search term)
2. If `q` is empty or <2 chars, return empty array
3. Query Supabase using ilike for simple substring matching: `.ilike('name', `%${q}%`)`
4. Limit results to 20 players
5. Select only needed fields: id, name, position, age, current_club, market_value_eur, nationality
6. Return JSON array of matching players

Use the existing supabase client from src/lib/supabase.ts.
Handle errors gracefully - return 500 with error message.

Note: Use ilike for simplicity (full-text search can be Phase 8 optimization).
  </action>
  <verify>
curl "http://localhost:3000/api/players/search?q=silva" should return JSON array of players with "silva" in name
curl "http://localhost:3000/api/players/search?q=" should return empty array
  </verify>
  <done>
- GET /api/players/search?q=X returns matching players as JSON
- Empty/short queries return []
- Errors return 500 with message
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SearchBar component with instant search</name>
  <files>src/components/SearchBar.tsx, src/app/page.tsx</files>
  <action>
Create SearchBar component:
1. "use client" directive (needs useState, useEffect)
2. Text input with placeholder "Search players..."
3. Debounce input (300ms) to avoid excessive API calls
4. Fetch from /api/players/search?q={query} on debounced value change
5. Display results below input as simple list:
   - Player name (bold), position, age
   - Current club
   - Market value formatted (€2.5M, €500K, etc.)
6. Show loading state while fetching
7. Show "No players found" for empty results with valid query
8. Style with Tailwind - clean, minimal design matching existing page aesthetic

Update homepage (src/app/page.tsx):
1. Import and render SearchBar component
2. Replace placeholder content with search-focused UI
3. Keep Bacau Scout branding at top

Helper function for market value formatting:
- 0 or null → "-"
- <1000 → "€{n}"
- <1000000 → "€{n/1000}K"
- ≥1000000 → "€{n/1000000}M"
  </action>
  <verify>
npm run dev - visit localhost:3000
Type "silva" - should see players appear after 300ms debounce
Clear input - results should disappear
Type "xyz123" - should show "No players found"
  </verify>
  <done>
- SearchBar renders on homepage
- Typing triggers debounced search
- Results display with name, position, club, market value
- Loading and empty states work
- UI is clean and responsive
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] API endpoint returns correct JSON for various queries
- [ ] Search works end-to-end in browser
- [ ] No TypeScript errors
- [ ] Results load quickly (<500ms perceived)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Search API returns players matching query
- SearchBar component shows instant results
- No errors or warnings introduced
- Phase 3 complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-player-search/03-01-SUMMARY.md` with:

# Phase 3 Plan 01: Player Search Summary

**[Substantive one-liner about what was built]**

## Performance
- Duration: X min
- Started/Completed timestamps

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [List with descriptions]

## Decisions Made
- [Any decisions and rationale]

## Issues Encountered
- [Problems and resolutions]

## Next Phase Readiness
- Ready for Phase 4: Player List View
</output>
