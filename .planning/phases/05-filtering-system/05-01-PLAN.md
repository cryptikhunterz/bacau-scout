---
phase: 05-filtering-system
plan: 01
type: execute
---

<objective>
Add filtering capabilities to player search with position, club, market value, and age filters.

Purpose: Allow scouts to narrow down player results by key criteria for efficient scouting.
Output: FilterPanel component integrated with search, API supporting filter parameters.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-player-list-view/04-01-SUMMARY.md

# Key files from prior phases:
@src/app/api/search/route.ts
@src/components/SearchBar.tsx
@src/components/PlayerList.tsx
@src/types/player.ts

**Tech stack available:** Next.js 14, React, Tailwind CSS
**Established patterns:** Client components, API routes, debounced search, view toggle
**Constraining decisions:**
- [Phase 3]: JSON file as data source (in-memory filtering)
- [Phase 3]: 300ms debounce for search input
- [Phase 4]: SearchPlayer type in shared types file
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend search API with filter parameters</name>
  <files>src/app/api/search/route.ts</files>
  <action>
Add filter query parameters to the search API:

1. Parse filter params from URL:
   - `position`: string (exact match, case-insensitive)
   - `club`: string (partial match, case-insensitive)
   - `minAge`, `maxAge`: number (inclusive range)
   - `minValue`, `maxValue`: number in EUR (parse "€500K" as 500000, "€1.5M" as 1500000)

2. Add helper function `parseMarketValue(value: string): number | null`:
   - Handle formats: "€500K" → 500000, "€1.5M" → 1500000, "€10M" → 10000000
   - Return null for unparseable values

3. Apply filters AFTER name search:
   - Each filter is optional (only apply if provided)
   - Filters are AND-ed together
   - Age and value ranges are inclusive

4. Return filtered results

Do NOT change existing name/URL search behavior - filters are additional refinement.
  </action>
  <verify>
Test with curl:
- `curl "/api/search?q=a&position=Centre-Forward"` returns only center forwards
- `curl "/api/search?q=a&minAge=20&maxAge=25"` returns players aged 20-25
  </verify>
  <done>
- Filter params parsed from URL
- parseMarketValue helper works
- Filters applied after name search
- Existing search still works unchanged
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FilterPanel component</name>
  <files>src/components/FilterPanel.tsx, src/types/player.ts</files>
  <action>
Create FilterPanel component with filter controls:

1. Add FilterState type to src/types/player.ts:
   ```
   interface FilterState {
     position: string;
     club: string;
     minAge: string;
     maxAge: string;
     minValue: string;
     maxValue: string;
   }
   ```

2. Create src/components/FilterPanel.tsx:
   - Props: `filters: FilterState`, `onChange: (filters: FilterState) => void`, `positions: string[]`
   - Collapsible panel (show/hide toggle)
   - Position: dropdown select with "All" + unique positions
   - Club: text input
   - Age: two number inputs (min/max) on same row
   - Market Value: two inputs (min/max) with "€" prefix, on same row
   - "Clear filters" button to reset all
   - Consistent dark/light theme styling matching existing components

3. Use Tailwind for layout:
   - Responsive grid: 1 col mobile, 2 cols tablet, 4 cols desktop
   - Compact inputs with clear labels
   - Subtle background to distinguish from results
  </action>
  <verify>TypeScript compiles: `npm run build`</verify>
  <done>
- FilterState type exported from types/player.ts
- FilterPanel component renders all filter controls
- Collapsible panel works
- Clear filters button resets state
- Responsive layout
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate FilterPanel with SearchBar</name>
  <files>src/components/SearchBar.tsx</files>
  <action>
Connect FilterPanel to SearchBar and search API:

1. Add filter state to SearchBar:
   - Import FilterPanel and FilterState
   - Initialize filter state with empty values
   - Track unique positions from results (extract from first search)

2. Build filter query string:
   - Create helper to build URL params from FilterState
   - Only include non-empty values
   - Append to existing search URL

3. Trigger search on filter changes:
   - Add filters to dependency array of search effect
   - Debounce filter changes (same 300ms)
   - Combine with existing query debounce

4. Position FilterPanel:
   - Place below search input, above results header
   - Show only when user has searched (hasSearched is true)

5. Extract unique positions:
   - On search results, extract unique position values
   - Sort alphabetically
   - Pass to FilterPanel for dropdown
  </action>
  <verify>
1. `npm run build` succeeds
2. `npm run dev` - search with filters works end-to-end
  </verify>
  <done>
- FilterPanel integrated with SearchBar
- Filters affect search results
- Position dropdown populated from results
- Filter changes trigger new search
- Build passes
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Search with position filter returns only matching positions
- [ ] Search with age range filter works
- [ ] Search with market value range filter works
- [ ] Search with club filter works
- [ ] Multiple filters combine correctly (AND logic)
- [ ] Clear filters resets to unfiltered search
- [ ] Dark mode styling consistent
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Filters work end-to-end
- FilterPanel integrates seamlessly with existing search UI
</success_criteria>

<output>
After completion, create `.planning/phases/05-filtering-system/05-01-SUMMARY.md`:

# Phase 5 Plan 01: Filtering System Summary

**[Substantive one-liner]**

## Performance

- **Duration:** X min
- **Started:** timestamp
- **Completed:** timestamp
- **Tasks:** 3
- **Files modified:** N

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Task Commits

1. **Task 1: Extend search API** - `hash` (feat)
2. **Task 2: Create FilterPanel** - `hash` (feat)
3. **Task 3: Integrate with SearchBar** - `hash` (feat)

## Files Created/Modified

- `src/app/api/search/route.ts` - Added filter parameters
- `src/components/FilterPanel.tsx` - New filter panel component
- `src/components/SearchBar.tsx` - Integrated FilterPanel
- `src/types/player.ts` - Added FilterState type

## Decisions Made

| Decision | Rationale |
|----------|-----------|
| ... | ... |

## Deviations from Plan

None / describe any

## Issues Encountered

None / describe any

## Next Phase Readiness

Phase 5 complete. Ready for **Phase 6: Player Detail Page**:
- Filtering system complete
- Search and filters working together
</output>
